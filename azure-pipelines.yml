trigger:
  branches:
    include:
    - master

pool:
  name: Default
  demands:
  - agent.name -equals Kala

steps:
# Check Java
- script: 'echo JAVA_HOME=%JAVA_HOME%'
  displayName: "Check JAVA_HOME"

# Verify Maven
- script: '"C:\Maven\bin\mvn.cmd" -version'
  displayName: "Verify Maven Installed"

# Build + Test using Maven
- script: '"C:\Maven\bin\mvn.cmd" clean test'
  displayName: "Run Maven Tests"

# Publish JUnit Test Results
- task: PublishTestResults@2
  displayName: "Publish JUnit Test Results"
  inputs:
    testResultsFormat: 'JUnit'
    testResultsFiles: '/surefire-reports/TEST-*.xml'
    mergeTestResults: true
    testRunTitle: 'JUnit Test Results'

# Package (optional, if you still want clean package)
- script: '"C:\Maven\bin\mvn.cmd" package'
  displayName: "Package Maven Project"